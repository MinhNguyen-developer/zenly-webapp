// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model User {
  id        String   @id @default(uuid())
  email     String   @unique
  username  String   @unique
  password  String
  name      String?
  avatar    String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // User's current location
  location Location?

  // Friends relationships (bidirectional)
  friends  Friendship[] @relation("UserFriends")
  friendOf Friendship[] @relation("FriendOfUser")

  // Friend requests sent
  sentRequests     FriendRequest[] @relation("RequestSender")
  // Friend requests received
  receivedRequests FriendRequest[] @relation("RequestReceiver")

  @@map("users")
}

model Location {
  id        String   @id @default(uuid())
  userId    String   @unique
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  latitude  Float
  longitude Float
  status    String?  @default("Available")
  updatedAt DateTime @updatedAt

  @@map("locations")
}

model Friendship {
  id        String   @id @default(uuid())
  userId    String
  friendId  String
  createdAt DateTime @default(now())

  user   User @relation("UserFriends", fields: [userId], references: [id], onDelete: Cascade)
  friend User @relation("FriendOfUser", fields: [friendId], references: [id], onDelete: Cascade)

  @@unique([userId, friendId])
  @@map("friendships")
}

model FriendRequest {
  id         String        @id @default(uuid())
  senderId   String
  receiverId String
  status     RequestStatus @default(PENDING)
  createdAt  DateTime      @default(now())
  updatedAt  DateTime      @updatedAt

  sender   User @relation("RequestSender", fields: [senderId], references: [id], onDelete: Cascade)
  receiver User @relation("RequestReceiver", fields: [receiverId], references: [id], onDelete: Cascade)

  @@unique([senderId, receiverId])
  @@map("friend_requests")
}

enum RequestStatus {
  PENDING
  ACCEPTED
  REJECTED
}
